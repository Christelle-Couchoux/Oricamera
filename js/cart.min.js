function displayCart(){let e=JSON.parse(localStorage.getItem("ordersList"));if(null===e||0===e.length)messageCartIsEmpty();else{let t=0;for(let n of e){const e=document.getElementById("cart-tablebody").appendChild(document.createElement("tr")),a=e.appendChild(document.createElement("td"));a.classList.add("td-name","align-left"),a.innerText=n.cameraName;const r=e.appendChild(document.createElement("td"));r.classList.add("td-lens"),r.innerText=n.cameraLens;const c=e.appendChild(document.createElement("td"));c.classList.add("td-price","align-right"),c.innerText=n.cameraPrice+" €";const o=e.appendChild(document.createElement("td"));o.classList.add("td-quantity"),o.setAttribute("id",t++);const i=o.appendChild(document.createElement("div"));i.classList.add("quantity-div"),i.appendChild(document.createElement("p")).innerText=n.cameraQuantity;const s=i.appendChild(document.createElement("button"));s.innerText="-",s.classList.add("btn-plusminus","btn-minus");const d=i.appendChild(document.createElement("button"));d.innerText="+",d.classList.add("btn-plusminus","btn-plus");const l=i.appendChild(document.createElement("button"));l.classList.add("btn-trash"),l.title="Supprimer le produit",l.appendChild(document.createElement("i")).className="fas fa-trash-alt";const m=e.appendChild(document.createElement("td"));m.classList.add("td-total","align-right"),m.innerText=n.cameraPrice*n.cameraQuantity+" €"}calculatePrice(e)}}function messageCartIsEmpty(){const e=document.createElement("div");e.classList.add("error"),e.innerText="Votre panier est vide !";const t=document.getElementById("continue").parentNode,n=document.getElementById("continue");t.insertBefore(e,n)}function calculatePrice(e){let t=[];for(let n of e){let e=n.cameraPrice*n.cameraQuantity;t.push(e)}const n=t.reduce(addUp,0);document.getElementById("total").innerText=n+" €",storeTotalPrice(n)}function addUp(e,t){return e+t}function storeTotalPrice(e){localStorage.setItem("orderTotal",JSON.stringify(e))}function quantityMinus(){let e=JSON.parse(localStorage.getItem("ordersList"));const t=document.getElementsByClassName("btn-minus");for(let n of t)n.addEventListener("click",function(t){t.preventDefault();let n=this.closest(".td-quantity").id;e[n].cameraQuantity=parseInt(e[n].cameraQuantity)-1,0===e[n].cameraQuantity&&e.splice(n,1),localStorage.setItem("ordersList",JSON.stringify(e)),window.location.href="cart.html"})}function quantityPlus(){let e=JSON.parse(localStorage.getItem("ordersList"));const t=document.getElementsByClassName("btn-plus");for(let n of t)n.addEventListener("click",function(t){t.preventDefault();let n=this.closest(".td-quantity").id;e[n].cameraQuantity=parseInt(e[n].cameraQuantity)+1,localStorage.setItem("ordersList",JSON.stringify(e)),window.location.href="cart.html"})}function removeItem(){const e=document.getElementsByClassName("btn-trash");for(let t of e)t.addEventListener("click",function(e){e.preventDefault();let t=this.closest(".td-quantity").id;storedOrders.splice(t,1),localStorage.setItem("ordersList",JSON.stringify(storedOrders)),window.location.href="cart.html"})}function continueShopping(){document.getElementById("continue").addEventListener("click",function(e){window.location.href="index.html"})}function emptyCart(){document.getElementById("empty").addEventListener("click",function(e){localStorage.removeItem("ordersList"),window.location.href="cart.html"})}function validateOrder(){const e=document.getElementById("submit");storedOrders=JSON.parse(localStorage.getItem("ordersList")),e.addEventListener("click",function(e){e.preventDefault(),createObjectContact()})}function createObjectContact(){const e=document.getElementById("firstname"),t=document.getElementById("lastname"),n=document.getElementById("address"),a=document.getElementById("city"),r=document.getElementById("email"),c=e.checkValidity(),o=t.checkValidity(),i=n.checkValidity(),s=a.checkValidity(),d=r.checkValidity();if(c&&o&&i&&s&&d){class c{constructor(e,t,n,a,r){this.firstName=e,this.lastName=t,this.address=n,this.city=a,this.email=r}}let o=new c(e.value,t.value,n.value,a.value,r.value);createArrayProducts(storedOrders,o)}else alert("Tous les champs du formulaire doivent être remplis et valides.")}function createArrayProducts(e,t){e=JSON.parse(localStorage.getItem("ordersList"));let n=[];for(let t of e){let e=t.cameraId;n.push(e)}createObjectToSend(t,n)}function createObjectToSend(e,t){send({contact:e,products:t})}function send(e){fetch("http://localhost:3000/api/cameras/order",{method:"POST",headers:{Accept:"application/json","Content-type":"application/json"},body:JSON.stringify(e)}).then(function(e){if(e.ok)return e.json()}).then(function(e){storeOrderId(e)}).catch(function(e){console.error("Erreur lors de la requête : ",e);const t=document.getElementById("order-form").appendChild(document.createElement("div"));t.classList.add("error"),t.innerText="Une erreur est survenue lors de la réponse serveur."})}function storeOrderId(e){localStorage.setItem("orderId",e.orderId);window.location="confirm.html",localStorage.removeItem("OrdersList")}continueShopping(),displayCart(),emptyCart(),quantityMinus(),quantityPlus(),removeItem(),validateOrder();