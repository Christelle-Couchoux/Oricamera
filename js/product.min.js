let productUrl=new URL(window.location.href),id=productUrl.searchParams.get("id");const url="http://localhost:3000/api/cameras/"+id;function displayProduct(e){const t=document.getElementById("div-info"),n=t.appendChild(document.createElement("h4"));n.classList.add("info__name"),n.innerText=e.name;const r=t.appendChild(document.createElement("div"));r.classList.add("info__image");const i=r.appendChild(document.createElement("img"));i.setAttribute("src",e.imageUrl),i.setAttribute("alt","Photo du modèle "+e.name);const a=t.appendChild(document.createElement("p"));a.classList.add("info__description"),a.innerText=e.description;const c=t.appendChild(document.createElement("p"));c.classList.add("info__price"),c.innerText=e.price/100+" €";const o=document.getElementById("lens-selection");for(let t of e.lenses){let e=o.appendChild(document.createElement("option"));e.setAttribute("value",t),e.innerText=t}}function addToCart(e){document.getElementById("addtocart").addEventListener("click",function(t){t.preventDefault(),createOrder(e)})}function createOrder(e){const t=document.getElementById("lens-selection"),n=t.checkValidity(),r=document.getElementById("quantity"),i=r.checkValidity();if(n)if(i){class n{constructor(e,t,n,r,i){this.cameraId=e,this.cameraName=t,this.cameraLens=n,this.cameraQuantity=r,this.cameraPrice=i}}storeOrder(new n(e._id,e.name,t.value,r.value,e.price/100))}else alert("Veuillez choisir une quantité supérieure à 0.");else alert("Veuillez choisir un objectif.")}function storeOrder(e){let t=JSON.parse(localStorage.getItem("ordersList"));if(t){let n=t.findIndex(t=>t.cameraId===e.cameraId);if(n===t.findIndex(t=>t.cameraLens===e.cameraLens)&&-1!==n){let r=parseInt(t[n].cameraQuantity)+parseInt(e.cameraQuantity);t[n].cameraQuantity=r,localStorage.setItem("ordersList",JSON.stringify(t)),window.location.href="cart.html"}else t.push(e),localStorage.setItem("ordersList",JSON.stringify(t)),window.location.href="cart.html"}else(t=[]).push(e),localStorage.setItem("ordersList",JSON.stringify(t)),window.location.href="cart.html"}fetch(url).then(function(e){if(e.ok)return e.json()}).then(function(e){displayProduct(e),addToCart(e)}).catch(function(e){console.error("Erreur lors de la requête : ",e);const t=document.createElement("div");t.classList.add("error"),t.innerText="Une erreur est survenue lors du chargement du produit.";const n=document.getElementById("div-info").parentNode,r=document.getElementById("div-info");n.insertBefore(t,r)});